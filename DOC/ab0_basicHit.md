# –§–æ—Ä–º—É–ª–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —É–¥–∞—Ä–∞ (ab0)

## 1. –ë–∞–∑–æ–≤–æ–µ –æ–∫–Ω–æ —É—Ä–æ–Ω–∞

–ë–µ—Ä—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω –∏–≥—Ä–æ–∫–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ts
baseMin = player.attack.min;
baseMax = player.attack.max;
```

- —ç—Ç–æ **—á–∏—Å—Ç—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω** —É—Ä–æ–Ω–∞ –æ—Ä—É–∂–∏–µ–º;
- –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —É–¥–∞—Ä–∞ (ab0) –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Å—Ç–∏—Ö–∏–π –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ `1.0`.

---

## 2. –†–æ–ª–ª —É—Ä–æ–Ω–∞ —Å —É—á—ë—Ç–æ–º —É–¥–∞—á–∏

```ts
function rollByLuck(minVal, maxVal, luck) {
  const L = clamp(luck / 100, 0, 1); // –Ω–æ—Ä–º–∏—Ä—É–µ–º —É–¥–∞—á—É –≤ 0..1
  const exp = Math.max(0.3, 1 - 0.7 * L); // —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –æ—Ç 1.0 –¥–æ 0.3
  const u = Math.random() ** exp; // —á–µ–º –º–µ–Ω—å—à–µ exp, —Ç–µ–º –±–ª–∏–∂–µ u –∫ 1
  return Math.round(minVal + (maxVal - minVal) * u);
}
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**

- –ü—Ä–∏ `luck=0` ‚Üí `exp=1` ‚Üí `u=random` ‚Üí —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ \[min,max].
- –ü—Ä–∏ `luck=100` ‚Üí `exp=0.3` ‚Üí `u=random^0.3` ‚Üí —Å–º–µ—â–µ–Ω–∏–µ –≤ —Å—Ç–æ—Ä–æ–Ω—É **–º–∞–∫—Å–∏–º—É–º–∞**.
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É–¥–∞—á–∞ **–Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω**, –∞ –º–µ–Ω—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: —É—Ä–æ–Ω —á–∞—â–µ –±–ª–∏–∂–µ –∫ `max`.

---

## 3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä

```ts
function getCritFromLuck(luck) {
  const pct = Math.floor(luck / 10); // –∫–∞–∂–¥—ã–µ 10 —É–¥–∞—á–∏ = +1% –∫—Ä–∏—Ç
  const did = Math.random() * 100 < pct;
  return { critMul: did ? 2 : 1, didCrit: did, critPct: pct };
}
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**

- –ü—Ä–∏ `luck=8` ‚Üí —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 0%.
- –ü—Ä–∏ `luck=80` ‚Üí —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 8%.
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä **—É–¥–≤–∞–∏–≤–∞–µ—Ç** –∏—Ç–æ–≥–æ–≤—ã–π —É—Ä–æ–Ω.

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–º–∞—Ö

–í –æ—Ä—É–∂–∏–∏ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–º–∞—Ö–æ–≤ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[15,30,45,60]`):

```ts
function getMissForWeapon(weapon, posIdx, luck) {
  const base = weapon.miss.baseByPos[posIdx - 1];
  const step = weapon.miss.luckStep ?? 10; // –∫–∞–∂–¥—ã–µ 10 —É–¥–∞—á–∏
  const per = weapon.miss.luckPerStepPct ?? 1; // —Å–Ω–∏–∂–∞–µ–º —à–∞–Ω—Å –ø—Ä–æ–º–∞—Ö–∞ –Ω–∞ 1%
  const steps = Math.floor(luck / step);
  const missPct = Math.max(0, base - steps * per);
  const didMiss = Math.random() * 100 < missPct;
  return { missPct, didMiss };
}
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**

- –ü—Ä–∏ `luck=0` ‚Üí –±–µ—Ä—ë–º `base`.
- –ü—Ä–∏ `luck=100` ‚Üí —à–∞–Ω—Å –ø—Ä–æ–º–∞—Ö–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 10% (10 —à–∞–≥–æ–≤ √ó 1%).
- –ü—Ä–æ–º–∞—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω—É–ª—è–µ—Ç —É—Ä–æ–Ω.

---

## 5. –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞

1. –†–æ–ª–ª–∏–º –±–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω:

   ```
   roll = rollByLuck(baseMin, baseMax, luck)
   ```

2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç:

   ```
   rollCrit = roll * critMul   // critMul = 1 –∏–ª–∏ 2
   ```

3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–º–∞—Ö:

   ```
   finalDamage = didMiss ? 0 : rollCrit
   ```

---

## üîé –ü—Ä–∏–º–µ—Ä

–ò–≥—Ä–æ–∫:

- `attack.min=20, attack.max=40`
- `luck=80`

–û—Ä—É–∂–∏–µ (–ø–æ–∑–∏—Ü–∏—è 3):

- `miss.baseByPos=[15,30,45,60]`
- –∑–Ω–∞—á–∏—Ç base=45% –ø—Ä–æ–º–∞—Ö–∞.

**–†–∞—Å—á—ë—Ç:**

1. –†–æ–ª–ª: `rollByLuck(20,40,80)` ‚Üí —á–∞—â–µ –±–ª–∏–∂–µ –∫ 40.
2. –ö—Ä–∏—Ç: —à–∞–Ω—Å 8%. –ï—Å–ª–∏ –≤—ã–ø–∞–ª ‚Äî √ó2.
3. –ü—Ä–æ–º–∞—Ö: —à–∞–Ω—Å = 45% ‚àí 8% = 37%.

–ò—Ç–æ–≥–æ:

- –£—Ä–æ–Ω 0 (–ú–ò–ú–û) —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 37%.
- –£—Ä–æ–Ω 20‚Äì40 (—Å—Ä–µ–¥–Ω–µ–µ –±–ª–∏–∂–µ –∫ 38) —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é \~55%.
- –£—Ä–æ–Ω 40‚Äì80 (–∫—Ä–∏—Ç) —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é \~8%.
